if(!window.oldmansoft){window.oldmansoft={}}window.oldmansoft.webapp=new (function(){var h=this,v={timeover:180000,loading_show_time:1000,loading_hide_time:200,server_charset:"utf-8"},r={ok:"Ok",yes:"Yes",no:"No",loading:"Loading",load_layout_error:"load layout error, click Ok to reload."},j=null,l=null,p=null,k=null,e=function(){return false},A=function(){return false},n=null,a=true,t=true,g=null,x=[],D=null,B=null,z,F,q,f=true,C,i=false;function y(K){if(!K){return""}if(K.indexOf("#")==0){return K.substr(1,K.length-1)}return K.replace(/\(/g,"(9)").replace(/\?/g,"(0)").replace(/\//g,"(1)").replace(/_/g,"(2)").replace(/#/g,"(3)").replace(/&/g,"(4)")}function u(K){if(!K){return""}return K.replace(/\(0\)/g,"?").replace(/\(1\)/g,"/").replace(/\(2\)/g,"_").replace(/\(3\)/g,"#").replace(/\(4\)/g,"&").replace(/\(9\)/g,"(")}function b(K){if(!K){return""}return K.replace(/\$7e/g,"~").replace(/\$23/g,"#").replace(/\$2f/g,"/").replace(/\$3f/g,"?").replace(/\$24/g,"$")}function d(M){var L=[],K,O;function N(P){if(!P){return""}if(P.substr(0,1)=="#"){return P.substr(1)}return P}if(M instanceof Array){L=M.slice()}else{K=N(M);if(K.indexOf("#")>-1||K.indexOf("%23")>-1){L=K.replace(/%23/g,"#").split("#")}else{if(K.indexOf("$")>-1){L=K.split("~");for(O=0;O<L.length;O++){L[O]=b(L[O])}}else{L=K.split("_");for(O=0;O<L.length;O++){L[O]=u(L[O])}}}}this.getLinks=function(){return L.slice()};this.push=function(P){return L.push(N(P))};this.pop=function(){return L.pop()};this.last=function(){return L[L.length-1]};this.getContent=function(){var P=[],Q;for(Q=0;Q<L.length;Q++){P.push(y(L[Q]))}return P.join("_")}}this.parser=function(K){return new d(K)};function w(N,P,L){var M,K,O;if(N==""){N=L}M=N.indexOf("&");if(M>-1){K=N.indexOf("?");if(K==-1||M<K){N=N.substr(0,M)}}if(N.substr(0,1)=="/"){return N}if(!P){P=document.location.pathname}else{K=P.indexOf("?");if(K>-1){P=P.substr(0,K)}M=P.indexOf("&");if(M>-1){P=P.substr(0,M)}}O=P.split("/");O.pop();return O.join("/")+"/"+N}function c(N,L,K){for(var M=L;M>-1;M--){if(N[M]==""&&K.substr(0,1)=="/"){return K}if(N[M].substr(0,1)=="/"){return N[M]}}return null}function G(L){var K,M;if(!L){return false}for(K=0;K<L.length;K++){M=L.substr(K,1);if(M==" "){continue}if(M=="\r"){continue}if(M=="\n"){continue}if(M=="\t"){continue}break}if(L.substr(K,15)=="<!DOCTYPE html>"){return true}if(L.substr(K,5)=="<html"){return true}return false}this.scriptLoader=new function(){var M=[];function L(P,O,N){if(P.length==O+1){N.resolve()}else{K(P,O+1,N)}}function K(P,O,N){if(M[P[O]]){L(P,O,N);return}$.getScript(P[O],function(){M[P[O]]=true;L(P,O,N)})}this.load=function(){var N=$.Deferred();if(arguments.length==0){N.resolve()}else{K(arguments,0,N)}return N}};this.bodyManagement=new function(){var K=0;this.expand=function(){if(K==0){$("body").addClass("layout-expanded");if(g){g.hide()}}K++};this.shrink=function(){K--;if(K==0){$("body").removeClass("layout-expanded");if(g){g.show()}}if(K<0){throw new Error("shrink error")}}};this.scrollbar=function(ae){if(!ae){return}var X,Z,T,W,O,M,af,R,V,Q,ad=true;function L(ag,ah){if(ag.selector=="body"){if(ah!=undefined){$(document).scrollTop(ah)}else{return $(document).scrollTop()}}else{if(ah!=undefined){ag.scrollTop(ah)}else{return ag.scrollTop()}}}function K(ai){var ah,ag;isSetTrackPosition=false;this.contentHeight=function(){return ah};this.viewHeight=function(){return ag};this.setHeight=function(){ah=ai.scrollHeight;ag=window.innerHeight};this.setTrackPosition=function(aj){if(isSetTrackPosition){return true}aj.css("right",0);aj.css("top",0);isSetTrackPosition=true;return true};this.bindMouseWheel=function(){$(window).on("mousewheel",U)};this.unbindMouseWheel=function(){$(window).off("mousewheel",U)}}function aa(aj,ai){var ah,ag;this.contentHeight=function(){return ah};this.viewHeight=function(){return ag};this.setHeight=function(){ah=ai.scrollHeight;ag=aj.innerHeight()};this.setTrackPosition=function(){return false};this.bindMouseWheel=function(){aj.on("mousewheel",U)};this.unbindMouseWheel=function(){aj.off("mousewheel",U)}}function ac(){var ag=(Z.viewHeight()-af)*L(ae)/(Z.contentHeight()-Z.viewHeight());M.css("top",ag)}function U(aj){var ai=aj.target,ak=aj.originalEvent.wheelDelta,ah,ag;while(ai!=aj.currentTarget&&ai!=null&&ai.tagName!="HTML"&&ai.tagName!="BODY"){ag=ai.style.overflowY;if((ag=="auto"||ag=="scroll")&&ai.clientHeight!=ai.scrollHeight){if(ak>0&&ai.scrollTop>0){return true}if(ak<0&&ai.scrollTop+ai.clientHeight<ai.scrollHeight){return true}}ai=ai.parentElement}if(Z.contentHeight()<=Z.viewHeight()){return true}ah=L(ae);if(ak<0){if(ah>=(Z.contentHeight()-Z.viewHeight())){return true}}else{if(ah==0){return true}}L(ae,ah-ak);ac();return false}function P(){return false}function S(ag){Q=ag.clientY;V=L(ae);R.on("selectstart",P);R.on("mousemove",N);R.on("mouseup",Y);W.addClass("focus")}function Y(){R.off("selectstart",P);R.off("mousemove",N);R.off("mouseup",Y);W.removeClass("focus")}function N(ah){var ag=(Z.contentHeight()-Z.viewHeight())/(Z.viewHeight()-af);L(ae,V-(Q-ah.clientY)*ag);ac()}function ab(){Z.setHeight();if(Z.viewHeight()==0||Z.contentHeight()<=Z.viewHeight()){W.hide();return}else{W.show()}W.height(Z.viewHeight());if(!Z.setTrackPosition(W)){W.css("left",ae.innerWidth()-parseInt(ae.css("padding-left"))-O);W.css("top",-parseInt(ae.css("padding-top")))}af=W.height()*Z.viewHeight()/Z.contentHeight();if(af<20){af=20}M.height(af);ac()}ae=$(ae);X=ae.get(0);Z=X.tagName=="BODY"?new K(X):new aa(ae,X);R=$("html");ae.css("overflow","hidden");T=$("<div></div>").addClass("scrollbar-container");W=$("<div></div>").addClass("scrollbar-track");M=$("<div></div>").addClass("scrollbar-arrow");T.append(W);W.append(M);ae.prepend(T);O=W.width();ab();x.push(this);W.mousedown(S);$(window).on("resize",ab);Z.bindMouseWheel();this.show=function(){if(ad){return}T.show();Z.bindMouseWheel();ad=true};this.hide=function(){if(!ad){return}Z.unbindMouseWheel();T.hide();ad=false};this.reset=function(){ab()}};this.resetScrollbar=function(){for(var K=0;K<x.length;K++){x[K].reset()}};this.resetWindowScrollbar=function(){if(g){g.reset();return}if(D==null){D="ontouchmove" in document}if(!D&&t){g=new h.scrollbar("body");setInterval(g.reset,500)}};function H(){function K(){var L=[];this.add=function(M){if(typeof(M)!="function"){throw new Error("fn is not a function")}L.push(M)};this.execute=function(M){for(var N=0;N<L.length;N++){if(L[N](M)===false){return false}}}}this.load=new K();this.unload=new K();this.active=new K();this.inactive=new K()}function I(L,K,M){this.node=L;this.name=K;this.level=M}function J(){var K=[];function L(N,U,M,T){var S,Q=true,P=0,R=0,O;this.link=U;this.node=$("<div></div>").addClass(N+"-view").data("link",U);this.valid=false;S=new I(this.node,N,M);this.hide=function(){if(!this.valid||!Q){return}var V=$(window);P=V.scrollTop();R=V.scrollLeft();if(O.inactive.execute(S)!==false){B.inactive.execute(S)}this.node.hide();Q=false};this.callLoadAndActive=function(){if(O.load.execute(S)!==false){B.load.execute(S)}if(O.active.execute(S)!==false){B.active.execute(S)}};this.callInactiveAndUnload=function(){if(O.inactive.execute(S)!==false){B.inactive.execute(S)}if(O.unload.execute(S)!==false){B.unload.execute(S)}};this.remove=function(){if(this.valid&&O.inactive.execute(S)!==false){B.inactive.execute(S)}this.node.remove();if(!this.valid){return}if(O.unload.execute(S)!==false){B.unload.execute(S)}this.node=null;this.valid=false;O=null};this.show=function(){if(!this.valid||Q){return}this.node.show();if(O.active.execute(S)!==false){B.active.execute(S)}$(window).scrollLeft(R);$(window).scrollTop(P);Q=true};this.activeEvent=function(){if(!O){B.active.execute(S);return}if(O.active.execute(S)!==false){B.active.execute(S)}};this.inactiveEvent=function(){if(!O){B.inactive.execute(S);return}if(O.inactive.execute(S)!==false){B.inactive.execute(S)}};this.setContext=function(){n=new H();this.node.empty();if(arguments.length==1){this.node.html(arguments[0])}else{for(var V=0;V<arguments.length;V++){this.node.append(arguments[V])}}O=n;this.valid=true};this.getOption=function(){return T}}this.push=function(M,O,N){K.push(new L(M,O,this.count()+1,N))};this.pop=function(){return K.pop()};this.last=function(){return K[K.length-1]};this.like=function(M){if(K.length==0){return false}for(var N=0;N<K.length;N++){if(M.length==N){break}if(K[N].link!=M[N]){return false}}return true};this.count=function(){return K.length};this.get=function(M){return K[M]};this.replace=function(N,M,Q,P){var O=new L(M,Q,N+1,P);K[N].node.after(O.node);K[N].remove();K[N]=O};this.getBackLink=function(){var M=new d(this.getLinks());M.pop();return M.getContent()};this.getLink=function(){var M=new d(this.getLinks());return M.getContent()};this.getLinks=function(){var M=[],N;for(N=0;N<K.length;N++){M.push(K[N].link)}return M}}this.box=function(Q,P){var N=false,M,L,R=[],O=null;function S(U,T){if(U&&U.target!=U.currentTarget){return}M.stop(true);M.fadeOut(R.length>0?0:200,function(){h.bodyManagement.shrink();if(O==null){if(T){T()}return}if(O.close){O.close()}O.node.remove();if(R.length>0){O=R.pop();L.append(O.node);M.stop(true,true);M.fadeIn(0);if(T){T()}return}O=null;if(T){T()}})}function K(){if(N){return}N=true;M=$("<div></div>").addClass(Q).addClass("box-background");if(P){L=$("<div></div>").addClass("layout-center-content");M.append($("<div></div>").addClass("layout-center").append(L))}else{L=M}M.prependTo($("body"));M.on("scroll",h.dealScrollToVisibleLoading)}this.open=function(T,U){K();if(O){if(O.node.data("type")=="message"){throw new Error("not allow show again after message show.")}R.push({node:O.node.detach(),close:O.close})}h.bodyManagement.expand();O={node:T,close:U};L.append(T);M.stop(true,true);M.fadeIn(200)};this.close=function(U,T){S(U,T)};this.clear=function(){if(!O){return}h.bodyManagement.shrink();if(O.close){O.close()}O.node.remove();while(R.length>0){O=R.pop();L.append(O.node);h.bodyManagement.shrink();if(O.close){O.close()}O.node.remove()}O=null;M.hide()}};k=new function(){var L,K=[];this.push=function(M){K.push(L);L=M};this.get=function(){return L};this.pop=function(){if(K.length==1){throw new Error("error call")}L=K.pop();return L}};z=new h.box("dialog-background",true);F=new h.box("window-background");q=new function(){var Q=false,L,K=[],O=null;function P(S,R){if(S&&S.target!=S.currentTarget){return}O.node.stop(true);O.node.fadeOut(K.length>0?0:200,function(){h.bodyManagement.shrink();if(O==null){if(R){R()}return}if(O.close){O.close()}O.node.remove();if(K.length>0){O=K.pop();O.node.stop(true,true);O.node.fadeIn(0);if(R){R()}return}O=null;if(R){R()}})}function M(){if(Q){return}Q=true;L=$("<div></div>").addClass("modal-areas");L.prependTo($("body"))}function N(T){var S,R;S=$("<div></div>").addClass("modal-background").addClass("box-background");R=$("<div></div>").addClass("layout-center-content");R.append(T);S.append($("<div></div>").addClass("layout-center").append(R));S.appendTo(L);S.on("click",function(U){if(U.currentTarget!=U.target){return}p.close()});return S}this.open=function(R,S){M();if(O){K.push({node:O.node,close:O.close})}h.bodyManagement.expand();O={node:N(R),close:S};O.node.stop(true,true);O.node.fadeIn(200)};this.close=function(S,R){P(S,R)};this.clear=function(){if(!O){return}h.bodyManagement.shrink();if(O.close){O.close()}O.node.remove();while(K.length>0){O=K.pop();h.bodyManagement.shrink();if(O.close){O.close()}O.node.remove()}O=null}};this.dialog=new function(){function K(){var L=$("<div></div>").addClass("dialog-box").addClass("box-panel");this.setHead=function(M){var N=$("<div></div>").addClass("dialog-header");N.append($("<h4></h4>").text(M));L.append(N)};this.setBody=function(N){var M=$("<div></div>").addClass("dialog-body");if(N.indexOf("\n")>-1){$.each(N.split("\n"),function(O,P){M.append($("<p></p>").text(P))})}else{M.text(N)}L.append(M)};this.setFooter=function(){var N=$("<div></div>").addClass("dialog-footer");function M(O){this.set=function(R,Q){var S,P=$("<button></button>").text(R).addClass(Q);P.click(function(T){z.close(T,function(){if(S){S()}})});O.append(P);return new function(){this.setCallback=function(T){S=T}}}}L.append(N);return new M(N)};this.get=function(M){L.data("type",M);return L};this.getElement=function(){return L}}this.alert=function(O,P,N){var Q,L=new K();function M(R){this.onConfirm=function(S){console.warn("onConfirm is obsolete. commend use ok");R.setCallback(S);return this};this.ok=function(S){R.setCallback(S);return this}}if(typeof P=="function"){N=P;P=null}if(P){L.setHead(P)}L.setBody(O);Q=L.setFooter().set(r.ok,"ok");if(N){console.warn("fn is obsolete. commend use ok");Q.setCallback(N)}z.open(L.get("alert"));return new M(Q)};this.confirm=function(Q,S,R,N){var L,M,T,P=new K();function O(V,U){this.onConfirm=function(W){console.warn("onConfirm is obsolete. commend use yes");V.setCallback(W);return this};this.yes=function(W){V.setCallback(W);return this};this.onCancel=function(W){console.warn("onCancel is obsolete. commend use no");U.setCallback(W);return this};this.no=function(W){U.setCallback(W);return this}}if(typeof S=="function"){N=R;R=S;S=null}if(S){P.setHead(S)}P.setBody(Q);T=P.setFooter();L=T.set(r.yes,"yes");if(R){console.warn("fnYes is obsolete.");L.setCallback(R)}M=T.set(r.no,"no");if(N){console.warn("fnNo is obsolete.");M.setCallback(N)}z.open(P.get("confirm"));return new O(L,M)};this.message=function(M){var L=new K();L.setBody(M);z.open(L.get("message"));return new function(){this.close=function(N){z.close(null,N)};this.change=function(N){L.getElement().find(".dialog-body").text(N)}}}};this.loadingTip=new function(){var K;function L(){if(K!=null){return}K=$("<div></div>").addClass("loading-background").addClass("box-background");var M=$("<div></div>").addClass("loading-box").addClass("box-panel"),N=$("<span></span>").text(r.loading);M.append(N);K.append($("<div></div>").addClass("layout-center").append($("<div></div>").addClass("layout-center-content").append(M)));K.prependTo($("body"))}this.show=function(){L();h.bodyManagement.expand();K.stop(true,true);K.fadeIn(v.loading_show_time);return new function(){this.hide=function(){h.loadingTip.hide()}}};this.hide=function(){L();K.stop(true);K.fadeOut(v.loading_hide_time,function(){h.bodyManagement.shrink()})}};this.linker=new function(){var K=false,P=null,N=null,Q=null;function L(R){if(!R){return R}if(R.substr(0,1)=="#"){return R.substr(1)}return R}function O(){N(P)}function M(){var R=new d(window.location.hash).getContent();if(P==R){return}P=R;O()}this.setChangeCompleted=function(R){Q=R};this.callChangeCompleted=function(R){if(!Q){return}Q(R);Q=null};this.createHref=function(R){var T=new d(R).getContent(),S=document.location.origin+document.location.pathname;if(T==""){return S}return S+"#"+T};this.modify=function(R){window.location.hash=R;P=new d(R).getContent()};this.hash=function(R){if(R==undefined){return window.location.hash}window.location.hash=R;if(R==P){O()}return R};this.link=function(R){if(R==undefined){return k.get().getLink()}R=y(R);window.location.hash=R;if(R==P){O()}};this.add=function(R){var S=new d(window.location.hash);S.push(R);window.location.hash=S.getContent()};this.same=function(R){var S=new d(window.location.hash);S.pop();S.push(R);window.location.hash=S.getContent();if(S.getContent()==P){O()}};this.refresh=function(){O()};this._init=function(R){if(K){return}K=true;N=R;P=L(window.location.hash);if("onhashchange" in window){window.onhashchange=M}else{window.setInterval(function(){if(P!=L(window.location.hash)){M()}},100)}O()}};function m(){var K=new J(),N;function M(R,S,P,T,O){var Q;if(K.count()==0){k.push(p)}K.push("modal",R,{closed:N.closed,closedParameters:N.closedParameters,data:S,type:P});Q=K.last();Q.node.addClass("box-panel");if(O==undefined){Q.setContext(T)}else{Q.setContext(T,O)}q.open(Q.node,function(){Q.remove()});Q.callLoadAndActive();h.dealScrollToVisibleLoading()}function L(Q,O){if(K.count()==0){return}var P=K.last();P.callInactiveAndUnload();if(O==undefined){P.setContext(Q)}else{P.setContext(Q,O)}P.callLoadAndActive();h.dealScrollToVisibleLoading()}this.load=function(Q,R,P){var S=h.loadingTip.show(),O;O=w(Q,c(K.getLinks(),K.count()-2,j.getDefaultLink()),j.getDefaultLink());$.ajax({mimeType:"text/html; charset="+v.server_charset,url:O,data:R,type:P,timeout:v.timeover}).done(function(W,X,V){S.hide();var T=V.getResponseHeader("X-Responded-JSON"),U;if(T){U=JSON.parse(T);if(U.status==401){if(!e(O,U.headers.location)){if(U.headers&&U.headers.location){document.location=U.headers.location}}return}}if(G(W)){alert("You try to load wrong content: "+O);return}if(N.refresh){L(W)}else{M(Q,R,P,W)}if(N.loaded){N.loaded()}}).fail(function(V,Z,W){var Y,T,X,U;S.hide();if(V.status==401){e(O)}else{if(V.status==0&&Z=="timeout"){Y=A();if(Y){if(N.refresh){L(Y)}else{M(Q,R,P,Y)}return}}}T=$(V.responseText);X=$("<h4></h4>").text(W);U=$("<pre></pre>");if(T[11]!=null&&T[11].nodeType==8){U.text(T[11].data)}else{U.text(T.eq(1).text())}if(N.refresh){L(X,U)}else{M(Q,R,P,X,U)}});N={closed:null,closedParameters:null,loaded:null,link:Q,data:R,type:P,refresh:false};return N};this.reload=function(){var P=K.last().getOption(),O=this.load(K.last().link,P.data,P.type);O.refresh=true};this.close=function(Q,O){var P=K.pop().getOption();q.close(null,function(){var R=K.last();if(!R){k.pop()}if(P.closed){if(P.closedParameters!=null){if(Q){P.closedParameters.unshift(Q)}P.closed.apply(null,P.closedParameters)}P.closed(Q)}if(O){O(false)}})};this.replace=function(P,Q){var O=K.last();O.callInactiveAndUnload();O.link=P;O.setContext(Q);O.callLoadAndActive()};this.clear=function(){q.clear();if(K.count()>0){K=new J();k.pop()}};this.getNode=function(){return K.last().node};this.getLink=function(){return K.last().link}}function o(){var K=new J(),N;function M(R,S,P,T,O){var Q;if(K.count()>0){K.last().hide()}else{j.inactiveCurrent();k.push(l)}K.push("open",R,{closed:N.closed,closedParameters:N.closedParameters,data:S,type:P});Q=K.last();if(O==undefined){Q.setContext(T)}else{Q.setContext(T,O)}F.open(Q.node,function(){Q.remove()});Q.callLoadAndActive();h.dealScrollToVisibleLoading()}function L(Q,O){if(K.count()==0){return}var P=K.last();P.callInactiveAndUnload();if(O==undefined){P.setContext(Q)}else{P.setContext(Q,O)}P.callLoadAndActive();h.dealScrollToVisibleLoading()}this.load=function(Q,R,P){var S=h.loadingTip.show(),O;p.clear();O=w(Q,c(K.getLinks(),K.count()-2,j.getDefaultLink()),j.getDefaultLink());$.ajax({mimeType:"text/html; charset="+v.server_charset,url:O,data:R,type:P,timeout:v.timeover}).done(function(W,X,V){S.hide();var T=V.getResponseHeader("X-Responded-JSON"),U;if(T){U=JSON.parse(T);if(U.status==401){if(!e(O,U.headers.location)){if(U.headers&&U.headers.location){document.location=U.headers.location}}return}}if(G(W)){alert("You try to load wrong content: "+O);return}if(N.refresh){L(W)}else{M(Q,R,P,W)}if(N.loaded){N.loaded()}}).fail(function(V,Z,W){var Y,T,X,U;S.hide();if(V.status==401){e(O)}else{if(V.status==0&&Z=="timeout"){Y=A();if(Y){if(N.refresh){L(Y)}else{M(Q,R,P,Y)}return}}}T=$(V.responseText);X=$("<h4></h4>").text(W);U=$("<pre></pre>");if(T[11]!=null&&T[11].nodeType==8){U.text(T[11].data)}else{U.text(T.eq(1).text())}if(N.refresh){L(X,U)}else{M(Q,R,P,X,U)}});N={closed:null,closedParameters:null,loaded:null,link:Q,data:R,type:P,refresh:false};return N};this.reload=function(){var P=K.last().getOption(),O=this.load(K.last().link,P.data,P.type);O.refresh=true};this.close=function(P,O){F.close(null,function(){var Q=K.pop().getOption(),R=K.last();if(R){R.show()}else{k.pop();j.activeCurrent()}if(Q.closed){if(Q.closedParameters!=null){if(P){Q.closedParameters.unshift(P)}Q.closed.apply(null,Q.closedParameters)}Q.closed(P)}if(O){O(false)}})};this.replace=function(P,Q){var O=K.last();O.callInactiveAndUnload();O.link=P;O.setContext(Q);O.callLoadAndActive()};this.clear=function(){F.clear();if(K.count()>0){K=new J();k.pop()}};this.getNode=function(){return K.last().node};this.getLink=function(){return K.last().link}}function s(R,Q){var L=0,N=null,O=Q,S=new J(),K=true;function M(V,T){var U;U=S.last();if(T==undefined){U.setContext(V)}else{U.setContext(V,T)}U.callLoadAndActive();h.resetWindowScrollbar();$(window).scrollTop(0);h.dealScrollToVisibleLoading()}function P(V,X,Y,W){var T=++L,Z=null,U=w(V,X,O);if(i){i=false}else{Z=h.loadingTip.show()}$.ajax({mimeType:"text/html; charset="+v.server_charset,url:U,type:"GET",timeout:v.timeover}).done(function(ad,ae,ac){if(T!=L){return}if(Z){Z.hide()}var aa=ac.getResponseHeader("X-Responded-JSON"),ab;if(aa){ab=JSON.parse(aa);if(ab.status==401){if(!e(U,ab.headers.location)){if(ab.headers&&ab.headers.location){document.location=ab.headers.location}}return}}if(G(ad)){alert("You try to load wrong content: "+U);return}Y();M(ad);if(W){W(true)}}).fail(function(ac,ag,ad){var af,aa,ae,ab;if(T!=L){return}if(Z){Z.hide()}if(ac.status==401){e(U)}else{if(ac.status==0&&ag=="timeout"){af=A();if(af){Y();M(af);return}}}aa=$(ac.responseText);ae=$("<h4></h4>").text(ad);ab=$("<pre></pre>");if(aa[11]!=null&&aa[11].nodeType==8){ab.text(aa[11].data)}else{ab.text(aa.eq(1).text())}Y();M(ae,ab)})}this.load=function(U,V){var W,T;if(N==null){N=$(R)}if(N.is("body")){throw new Error("viewNode can't be <body>")}W=new d(U).getLinks();p.clear();l.clear();z.clear();if(S.count()>W.length&&S.like(W)&&S.get(W.length-1).valid){for(T=S.count()-1;T>W.length-1;T--){S.pop().remove()}S.last().show();h.resetWindowScrollbar();if(V){V(false)}return}P(W[W.length-1],c(W,W.length-2,O),function(){var Y,X;if(K){N.empty();K=false}if(S.count()>W.length&&S.like(W)){for(Y=S.count()-1;Y>W.length-1;Y--){S.pop().remove()}}else{X=S.count();for(Y=X-1;Y>W.length-1;Y--){S.pop().remove()}for(Y=0;Y<W.length;Y++){if(X>Y){if(S.get(Y).link!=W[Y]||(X==Y+1&&W.length==X)){S.replace(Y,"main",W[Y],{baseLink:c(W,Y-1,O)})}else{S.get(Y).hide()}}else{S.push("main",W[Y],{baseLink:c(W,Y-1,O)});N.append(S.last().node)}}}},V)};this.reload=function(){P(S.last().link,S.last().getOption().baseLink,function(){S.last().callInactiveAndUnload()})};this.close=function(U,T){if(S.count()>1){if(S.get(S.count()-2).valid){S.pop().remove();h.linker.modify(S.getLink());S.last().show();h.resetWindowScrollbar();if(T){T(false)}}else{h.linker.setChangeCompleted(T);h.linker.hash(S.getBackLink())}}};this.replace=function(U,V){var T=S.last();T.callInactiveAndUnload();T.link=U;T.setContext(V);T.callLoadAndActive()};this.getElement=function(){return N};this.setElement=function(T){return N=$(T)};this.getDefaultLink=function(){return O};this.setDefaultLink=function(T){O=T};this.activeCurrent=function(){S.last().activeEvent()};this.inactiveCurrent=function(){S.last().inactiveEvent()};this.getLinks=function(){return S.getLinks()};this.getNode=function(){return S.last().node};this.getLink=function(){return S.last().link}}this.current=function(){return{node:k.get().getNode(),link:k.get().getLink(),view:k.get()}};this.event=function(){return new function(){this.onLoad=function(K){n.load.add(K);return this};this.onUnload=function(K){n.unload.add(K);return this};this.onActive=function(K){n.active.add(K);return this};this.onInactive=function(K){n.inactive.add(K);return this}}};this.viewClose=function(L,K){k.get().close(L,K)};this.viewReload=function(){k.get().reload()};this.dealScrollToVisibleLoading=function(K){var M,L;if(K&&typeof(K.find)=="function"){M=K.find(".webapp-loading:visible").first()}else{M=$(".webapp-loading:visible").first()}if(M.length>0&&!M.data("work")&&$(window).scrollTop()+$(window).height()>M.offset().top){M.data("work",true);L=M.attr("data-src");if(!L){return}$.get(L,function(N){M.before(N);M.remove();h.resetWindowScrollbar();h.dealScrollToVisibleLoading(K)})}};function E(N){var M,L,K=true;if($("body").hasClass("layout-expanded")){M=N.originalEvent.path;if(!M){return}for(L=0;L<M.length;L++){if(M[L].tagName=="BODY"){break}if(M[L].scrollHeight>M[L].clientHeight){K=false;break}}if(K){N.preventDefault()}}}this.dealHrefTarget={_base:function(K){h.linker.link(K)},_link:function(K){h.linker.link(K)},_add:function(K){h.linker.add(K)},_same:function(K){h.linker.same(K)},_open:function(K,L){h.open(K,L.attr("data-data"))},_modal:function(K,L){h.modal(K,L.attr("data-data"))}};this.configTarget=function(K){if(typeof K=="function"){K(h.dealHrefTarget)}};this.hashes=function(){return j.getLinks()};this.open=function(K,M){var L;if(M){L=l.load(K,M,"POST")}else{L=l.load(K,M,"GET")}return new function(){this.closed=function(O){L.closed=O;if(arguments.length>1){L.closedParameters=[];for(var N=1;N<arguments.length;N++){L.closedParameters.push(arguments[N])}}};this.loaded=function(N){L.loaded=N}}};this.modal=function(K,M){var L;if(M){L=p.load(K,M,"POST")}else{L=p.load(K,M,"GET")}return new function(){this.closed=function(O){L.closed=O;if(arguments.length>1){L.closedParameters=[];for(var N=1;N<arguments.length;N++){L.closedParameters.push(arguments[N])}}};this.loaded=function(N){L.loaded=N}}};this.find=function(K){return h.current().node.find(K)};this.configSetting=function(K){if(typeof K=="function"){K(v)}};this.configText=function(K){if(typeof K=="function"){K(r)}};this.option=function(){return C};this.initialization=function(L,K){function M(N){this.viewNode=function(O){if(!O){return N.getElement()}N.setElement(O);return this};this.defaultLink=function(O){if(!O){return N.getDefaultLink()}N.setDefaultLink(O);return this};this.unauthorized=function(O){e=O;return this};this.loadTimeout=function(O){A=O;return this};this.dealLinkEmptyTarget=function(O){if(O==undefined){return a}a=O;return this};this.replacePCScrollBar=function(O){t=O;return this};this.viewLoaded=function(O){B.load.add(O);return this};this.viewActived=function(O){B.active.add(O);return this};this.viewInactived=function(O){B.inactive.add(O);return this};this.viewUnloaded=function(O){B.unload.add(O);return this}}if(!!window.ActiveXObject||"ActiveXObject" in window){$.ajaxSetup({cache:false})}$(document).on("click","a",function(P){var O=$(this).attr("target"),N=$(this).attr("href");if(N=="#"){P.preventDefault();return}if(!O){if(!a){return}P.preventDefault();h.dealHrefTarget._link(N);return}if(O=="_none"){return}if(h.dealHrefTarget[O]){P.preventDefault();h.dealHrefTarget[O](N,$(this))}});$(document).on("click",".webapp-close",function(N){N.preventDefault();h.viewClose($(this).attr("data-close"))});$(window).on("scroll",h.dealScrollToVisibleLoading);$(window).on("resize",h.dealScrollToVisibleLoading);$(document).on("touchmove",E);B=new H();j=new s(L,K);l=new o();p=new m();k.push(j);C=new M(j);return C};this.init=function(N,L,M){var K=h.initialization(N,L);if(M){i=true}h.linker._init(function(O){j.load(O,h.linker.callChangeCompleted)});return K};this.setup=function(N,L,M){if(f){f=false}else{throw new Error("Has been setup")}var K=h.initialization(N,L);$(function(){if(M){i=true}h.linker._init(function(O){j.load(O,h.linker.callChangeCompleted)})});return K};this.setupLayout=function(M,O,N,L){if(f){f=false}else{throw new Error("Has been setup")}var K=h.initialization(N,L);$(function(){$.ajax({mimeType:"text/html; charset="+v.server_charset,url:O,type:"GET",timeout:v.timeover}).done(function(S,T,R){var P=R.getResponseHeader("X-Responded-JSON"),Q;if(P){Q=JSON.parse(P);if(Q.status==401){if(!e(O,Q.headers.location)){if(Q.headers&&Q.headers.location){document.location=Q.headers.location}}return}}if(G(S)){alert("You try to load wrong content: "+O);return}$(M).html(S).children().unwrap();i=true;h.linker._init(function(U){j.load(U,h.linker.callChangeCompleted)})}).fail(function(P,S,Q){var R;if(P.status==401){e(O)}else{if(P.status==0&&S=="timeout"){R=A();if(R){$(M).html(R).children().unwrap();return}}}h.dialog.alert(r.load_layout_error,Q).ok(function(){document.location.reload()})})});return K};window.$app={configSetting:h.configSetting,configText:h.configText,alert:h.dialog.alert,confirm:h.dialog.confirm,message:h.dialog.message,loading:h.loadingTip.show,loadScript:h.scriptLoader.load,href:h.linker.createHref,hash:h.linker.hash,link:h.linker.link,add:h.linker.add,same:h.linker.same,open:h.open,modal:h.modal,event:h.event,reload:h.viewReload,close:h.viewClose,current:h.current,find:h.find,option:h.option,init:h.init,setup:h.setup,setupLayout:h.setupLayout}})();